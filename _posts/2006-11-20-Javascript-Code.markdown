---
layout: post
title: Javascript Code
date: 2006-11-20
---

I've written a few posts about using javascript with web services.  Nothing amazingly unique about this code. It's IE6 only.<br /><br />//this calls "mapfunc()" when the page loads<br />&lt;body onload="mapfunc();"&gt;<br /><br />//calls StartProgress then it sends the packet<br />function mapfunc(){<br />  StartProgress(40);    //displays and increments a progress bar<br /><br />  //sends the packet, the response is handled by receivemapResponse<br />  sendPacket("",receivemapResponse);<br />}<br /><br /><br />//sends the packet - the packet can be any text.  It is blank for the heatmap<br />function sendPacket(packet,OnReadyStateChangeFuntion){<br />  webservHTTP=new ActiveXObject("MSXML2.XMLHTTP.3.0");<br />  webservHTTP.Open("POST", webservurl, true);<br />  webservHTTP.setRequestHeader("Content-Type","text/xml; charset=utf-8");<br /><br />   //sets the response funtion - passing functions in javascript is very powerful<br />  webservHTTP.onreadystatechange = OnReadyStateChangeFuntion;<br />  webservHTTP.send(packet);<br />}<br /><br />//this function is called when a response is received<br />function receivemapResponse(){<br />  if (webservHTTP.readyState==4){<br />      if(webservHTTP.status==200 &&amp; webservHTTP.statusText == "OK"){<br />          $("heat").innerHTML = (webservHTTP.responseText);//loads the response into the page<br />          StopProgress();//stops the progess bar once finished<br />      }<br />      else{ StopProgress(); }      <br />  }<br />}<br /><br />//progress bar functions and html<br />function $(id){    return document.getElementById(id)};<br />var progressID;<br />function incrementProgress(){<br />  var cwidth = $("progress").style.width;<br />  cwidth = Number(cwidth.substr(0,cwidth.indexOf("p")))+2;<br />  if(cwidth != 200)<br />      $("progress").style.width = cwidth + "px";<br />  else<br />      $("progress").style.width = "0px";<br />}<br />function StartProgress(interval){<br />  $("progresstext").innerHTML = "Loading.....";<br />  $("outerprogress").style.display = "";<br />  progressID = setInterval("incrementProgress()",interval);<br />}<br />function StopProgress(){<br />  clearInterval(progressID);<br />  $("progresstext").innerHTML = "Loaded!";<br />  $("progress").style.width = "100%";<br />  setTimeout("FinishProgress()",500);<br />}<br />function FinishProgress(){<br />  $("outerprogress").style.display = "none";<br />  $("progress").style.width = "0px";<br />}<br /><br /><!--html--><br />      &lt;span id="outerprogress" style="position:absolute;Right:0px;top:0px;width:200px;height:20px;border:black solid 1px;display:none;background-"&gt;&lt;!--border--&gt;<br /><br />          &lt;span id="progress" style="width: 0px;overflow:hidden;height:20px;"&gt;&lt;!--progress bar--&gt;<br /><br />                  &lt;span id="progresstext" style="font-weight:bold;padding-left:5px;height:20px;vertical-align:bottom;"&gt;&lt;/span&gt;&lt;!--static words--&gt;<br /><br />          &lt;/span&gt;<br /><br />      &lt;/span&gt;
